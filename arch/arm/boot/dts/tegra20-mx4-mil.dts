/dts-v1/;

#include "tegra20-colibri-512.dtsi"

/ {
	model = "Toradex Colibri T20 512MB on MX-4 MIL";
	compatible = "hostmobility,mx4-mil", "toradex,colibri_t20-512", "nvidia,tegra20";

	aliases {
		serial0 = &uarta;
		serial1 = &uartb;
		serial2 = &uartc;
		serial3 = &uartd;
	};

	pinmux@70000014 {
		state_default: pinmux {
			hdint {
				nvidia,tristate = <TEGRA_PIN_DISABLE>;
			};

			i2cddc {
				nvidia,tristate = <TEGRA_PIN_DISABLE>;
			};

			sdio4 {
				nvidia,tristate = <TEGRA_PIN_DISABLE>;
			};

			uarta {
				nvidia,tristate = <TEGRA_PIN_DISABLE>;
			};

			uartb {
				nvidia,tristate = <TEGRA_PIN_DISABLE>;
			};

			uartc {
				nvidia,tristate = <TEGRA_PIN_DISABLE>;
			};

			uartd {
				nvidia,tristate = <TEGRA_PIN_DISABLE>;
			};

			spi4 {
				nvidia,pull = <TEGRA_PIN_PULL_UP>;
				nvidia,tristate = <TEGRA_PIN_DISABLE>;
			};

			gpio_gmi {
				nvidia,pins = "ata", "atc", "atd", "ate",
					"dap1", "dap2", "dap4", "gpu", "spia",
					"spib", "spic", "ucb";
			};
		};
	};

	serial@70006000 {
		status = "okay";
	};

	serial@70006040 {
		status = "okay";
	};

	serial@70006200 {
		status = "okay";
	};

	serial@70006300 {
		status = "okay";
	};

	i2c_ddc: i2c@7000c400 {
		status = "okay";
	};

	usb@c5000000 {
		compatible = "nvidia,tegra20-udc";
		status = "okay";
		dr_mode = "peripheral";
	};

	usb-phy@c5000000 {
		status = "okay";
	};

	usb@c5008000 {
		status = "okay";
	};

	usb-phy@c5008000 {
		status = "okay";
	};

	gmi@70009000 {
		ranges = <4 0 0xd0000000 0xfffffff>;
		status = "okay";

		bus@4,0 {
			compatible = "simple-bus";
			#address-cells = <1>;
			#size-cells = <1>;
			ranges = <0 4 0 0x80100>;

			nvidia,snor-mux-mode;
			nvidia,snor-adv-active-high;

			can@0 {
				compatible = "nxp,sja1000";
				reg = <0 0x100>;
				interrupt-parent = <&gpio>;
				interrupts = <TEGRA_GPIO(B, 5) IRQ_TYPE_EDGE_RISING>;
				nxp,external-clock-frequency = <24000000>;
				nxp,tx-output-config = <0x16>;
				nxp,clock-out-frequency = <24000000>;
				reg-io-width = <2>;
			};

			can@40000 {
				compatible = "nxp,sja1000";
				reg = <0x40000 0x100>;
				interrupt-parent = <&gpio>;
				interrupts = <TEGRA_GPIO(A, 6) IRQ_TYPE_EDGE_RISING>;
				nxp,external-clock-frequency = <24000000>;
				nxp,tx-output-config = <0x16>;
				reg-io-width = <2>;
			};

			can@80000 {
				compatible = "nxp,sja1000";
				reg = <0x80000 0x100>;
				interrupt-parent = <&gpio>;
				interrupts = <TEGRA_GPIO(N, 0) IRQ_TYPE_EDGE_RISING>;
				nxp,external-clock-frequency = <24000000>;
				nxp,tx-output-config = <0x16>;
				reg-io-width = <2>;
			};
		};
	};

	/* SPI4: Colibri SSP */
	spi@7000da00 {
		status = "okay";
		spi-max-frequency = <25000000>;

		mx4_io_spi: spi@0 {
			compatible = "mx4_io_spi";
			reg = <0>;
			spi-max-frequency = <5000000>;
			interrupt-parent = <&gpio>;
			interrupts = <TEGRA_GPIO(Y, 6) GPIO_ACTIVE_HIGH>;
			spi-cpha;
		};

		mx4_pic: spi@1 {
			compatible = "hostmobility,mx4_pic";
			reg = <1>;
			spi-max-frequency = <25000000>;
		};
	};

	regulators {
		regulator@0 {
			compatible = "regulator-fixed";
			reg = <0>;
			regulator-name = "usb_host_vbus";
			regulator-min-microvolt = <5000000>;
			regulator-max-microvolt = <5000000>;
			regulator-boot-on;
			regulator-always-on;
			gpio = <&gpio TEGRA_GPIO(W, 2) GPIO_ACTIVE_HIGH>;
		};

		vcc_sd_reg: regulator@1 {
			compatible = "regulator-fixed";
			reg = <1>;
			regulator-name = "vcc_sd";
			regulator-min-microvolt = <3300000>;
			regulator-max-microvolt = <3300000>;
			regulator-boot-on;
			regulator-always-on;
		};
	};
};
